!(function (e, n) { typeof exports === 'object' && typeof module !== 'undefined' ? n(exports) : typeof define === 'function' && define.amd ? define(['exports'], n) : n(((e = e || self).casl = e.casl || {}, e.casl.extra = {})); }(this, (e) => {
  const u = function (e) { return e.fields; }; const c = function (e) { return Array.isArray(e) ? e.join(',') : e; }; e.rulesToQuery = function (e, n, r, t) { for (var i = {}, o = {}, u = e.rulesFor(n, r), s = 0; s < u.length; s++) { const c = u[s]; const f = c.inverted ? '$and' : '$or'; if (c.conditions)o.hasOwnProperty(f) || (i[f] = i[f] || [], i[f].push(t(c))); else { if (c.inverted) return null; i[f] && delete i[f], o[f] = !0; } } return u.length > 0 ? i : null; }, e.rulesToFields = function (e, n, r) { return e.rulesFor(n, r).filter(e => !e.inverted && e.conditions).reduce((e, t) => Object.keys(t.conditions).reduce((e, n) => { const r = t.conditions[n]; return r && r.constructor === Object || (function (e, n, r) { let t = e; let i = n; if (n.indexOf('.') !== -1) { const o = n.split('.'); i = o.pop(), t = o.reduce((e, n) => e[n] = e[n] || {}, e[n], e); }t[i] = r; }(e, n, r)), e; }, e), {}); }, e.permittedFieldsOf = function (e, n, r, t) {
    void 0 === t && (t = {}); const i = t.fieldsFrom || u; const o = e.possibleRulesFor(n, r).slice(0).reverse().filter(e => e.matches(r))
      .reduce((e, n) => { const r = i(n); if (r) { const t = n.inverted ? 'delete' : 'add'; r.forEach(e[t], e); } return e; }, new Set()); return Array.from(o);
  }, e.packRules = function (e) { return e.map((e) => { for (var n = e.actions, r = e.subject, t = e.conditions, i = e.inverted, o = e.fields, u = e.reason, s = [c(n), c(r), t || 0, i ? 1 : 0, c(o) || 0, u || 0]; !s[s.length - 1];)s.pop(); return s; }); }, e.unpackRules = function (e) { return e.map((e) => { const n = e[0]; const r = e[1]; const t = e[2]; const i = e[3]; const o = e[4]; const u = e[5]; return { actions: n.split(','), subject: r.split(','), inverted: !!i, conditions: t || null, fields: o ? o.split(',') : null, reason: u || null }; }); }, Object.defineProperty(e, '__esModule', { value: !0 });
}));
